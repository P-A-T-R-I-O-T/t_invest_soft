# data/participants_manager.py

import json
import os
from cryptography.fernet import Fernet

# –ü—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º
KEY_FILE = "data/unique_data/key.key"       # –§–∞–π–ª –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–ª—é—á–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
DATA_FILE = "data/unique_data/participants.enc"  # –§–∞–π–ª –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

class ParticipantsManager:
    def __init__(self):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.
        –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–∞:
        - –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –ø–∞–ø–∫–∞ data/ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        - –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
        - –°–æ–∑–¥–∞—ë–º –æ–±—ä–µ–∫—Ç Fernet –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è/–¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
        """
        # –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –¥–ª—è –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
        os.makedirs(os.path.dirname(KEY_FILE), exist_ok=True)
        os.makedirs(os.path.dirname(DATA_FILE), exist_ok=True)  # –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π –∏ –¥–ª—è DATA_FILE

        self.key = self.load_or_generate_key()  # –ü–æ–ª—É—á–∞–µ–º –∫–ª—é—á (—Å–æ–∑–¥–∞—ë–º, –µ—Å–ª–∏ –Ω–µ—Ç)
        self.cipher = Fernet(self.key)  # –û–±—ä–µ–∫—Ç –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏



    def load_or_generate_key(self):
        """
        –ü—ã—Ç–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–ª—é—á –∏–∑ —Ñ–∞–π–ª–∞.
        –ï—Å–ª–∏ —Ñ–∞–π–ª–∞ key.key –Ω–µ—Ç ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π –∫–ª—é—á –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ.
        –ö–ª—é—á –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö.
        –í–∞–∂–Ω–æ: –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∫–ª—é—á –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤—Å–µ–≥–¥–∞, –∏–Ω–∞—á–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Ä–∞—Å—à–∏—Ñ—Ä—É—é—Ç—Å—è!
        """
        if os.path.exists(KEY_FILE):
            # –ö–ª—é—á —É–∂–µ –µ—Å—Ç—å ‚Äî —á–∏—Ç–∞–µ–º –µ–≥–æ –∏–∑ —Ñ–∞–π–ª–∞
            with open(KEY_FILE, "rb") as f:
                return f.read()
        else:
            # –ö–ª—é—á–∞ –Ω–µ—Ç ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π
            key = Fernet.generate_key()
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª—é—á –≤ —Ñ–∞–π–ª, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –±—É–¥—É—â–µ–º
            with open(KEY_FILE, "wb") as f:
                f.write(key)
            return key

    def add_participant(self, name: str, token: str, is_sandbox: bool = False) -> bool:
        """
        –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ —Å –∏–º–µ–Ω–µ–º, —Ç–æ–∫–µ–Ω–æ–º –∏ —Ñ–ª–∞–≥–æ–º –ø–∏—Å–æ—á–Ω–∏—Ü—ã.
        –ü–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º:
        - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∏–º—è –∏ —Ç–æ–∫–µ–Ω –Ω–µ –ø—É—Å—Ç—ã–µ
        - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∏–º—è –µ—â—ë –Ω–µ –∑–∞–Ω—è—Ç–æ
        –ï—Å–ª–∏ –≤—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ ‚Äî —à–∏—Ñ—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ —Ñ–∞–π–ª.

        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç True, –µ—Å–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω, –∏–Ω–∞—á–µ False.
        """
        if not name or not token:
            print("‚ùå –û—à–∏–±–∫–∞: –∏–º—è –∏ —Ç–æ–∫–µ–Ω –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã.")
            return False

        if self.name_exists(name):
            print(f"‚ùå –û—à–∏–±–∫–∞: —É—á–∞—Å—Ç–Ω–∏–∫ —Å –∏–º–µ–Ω–µ–º '{name}' —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.")
            return False

        # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
        data = {
            "name": name,
            "token": token,
            "is_sandbox": is_sandbox  # —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–µ—Å–æ—á–Ω–∏—Ü—ã
        }
        # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–∫—É JSON –∏ —à–∏—Ñ—Ä—É–µ–º –µ—ë
        encrypted_data = self.cipher.encrypt(json.dumps(data).encode())

        # –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª –≤ —Ä–µ–∂–∏–º–µ "–¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –±–∏–Ω–∞—Ä–Ω–æ–º –≤–∏–¥–µ" –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É
        # –ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ (—Å –ø–µ—Ä–µ–Ω–æ—Å–æ–º \n)
        with open(DATA_FILE, "ab") as f:
            f.write(encrypted_data + b"\n")

        print(f"‚úÖ –£—á–∞—Å—Ç–Ω–∏–∫ '{name}' —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω. –ü–µ—Å–æ—á–Ω–∏—Ü–∞: {is_sandbox}")
        return True

    def name_exists(self, name: str) -> bool:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ —É–∂–µ —É—á–∞—Å—Ç–Ω–∏–∫ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º.
        –î–ª—è —ç—Ç–æ–≥–æ:
        - –ß–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª –ø–æ—Å—Ç—Ä–æ—á–Ω–æ
        - –†–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç –∫–∞–∂–¥—É—é –∑–∞–ø–∏—Å—å
        - –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –∏–º—è
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç True, –µ—Å–ª–∏ –∏–º—è –Ω–∞–π–¥–µ–Ω–æ.
        """
        # –ï—Å–ª–∏ —Ñ–∞–π–ª–∞ –µ—â—ë –Ω–µ—Ç ‚Äî –∑–Ω–∞—á–∏—Ç, —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–µ—Ç
        if not os.path.exists(DATA_FILE):
            return False

        try:
            with open(DATA_FILE, "rb") as f:
                for line in f:
                    line = line.strip()  # –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã –∏ –ø–µ—Ä–µ–Ω–æ—Å—ã
                    if not line:  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
                        continue
                    # –†–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É
                    decrypted_data = self.cipher.decrypt(line).decode()
                    # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º JSON –æ–±—Ä–∞—Ç–Ω–æ –≤ —Å–ª–æ–≤–∞—Ä—å
                    participant = json.loads(decrypted_data)
                    # –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –∏–º—è
                    if participant["name"] == name:
                        return True
        except Exception as e:
            # –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å), –≤—ã–≤–æ–¥–∏–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
            print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: {e}")
        return False

    def get_token_by_name(self, name: str) -> str or None:
        """
        –ò—â–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–∞ –ø–æ –∏–º–µ–Ω–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ —Ç–æ–∫–µ–Ω.
        –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –≤—Ö–æ–¥–µ ‚Äî —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–∏ —Ç–æ–∫–µ–Ω –≤–≤—ë–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–∫–µ–Ω (—Å—Ç—Ä–æ–∫–∞) –∏–ª–∏ None, –µ—Å–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω.
        """
        if not os.path.exists(DATA_FILE):
            return None

        try:
            with open(DATA_FILE, "rb") as f:
                for line in f:
                    line = line.strip()
                    if not line:
                        continue
                    decrypted_data = self.cipher.decrypt(line).decode()
                    participant = json.loads(decrypted_data)
                    if participant["name"] == name:
                        return participant["token"]  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–∫–µ–Ω
        except Exception as e:
            print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞: {e}")
        return None
    
    def get_participant_by_name(self, name: str) -> dict or None:
        """
        –ò—â–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–∞ –ø–æ –∏–º–µ–Ω–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –µ–≥–æ –¥–∞–Ω–Ω—ã–µ (–≤–∫–ª—é—á–∞—è —Ñ–ª–∞–≥ –ø–µ—Å–æ—á–Ω–∏—Ü—ã).
        –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏–ª–∏ None, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω.
        """
        if not os.path.exists(DATA_FILE):
            return None

        try:
            with open(DATA_FILE, "rb") as f:
                for line in f:
                    line = line.strip()
                    if not line:
                        continue
                    decrypted_data = self.cipher.decrypt(line).decode()
                    participant = json.loads(decrypted_data)
                    if participant["name"] == name:
                        return participant  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞
        except Exception as e:
            print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–∞: {e}")
        return None
    
    def is_sandbox_user(self, name: str) -> bool:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –ø–µ—Å–æ—á–Ω–∏—Ü—ã.
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç True, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Å–æ—á–Ω–∏—Ü—ã, –∏–Ω–∞—á–µ False (–∏–ª–∏ –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω).
        """
        participant = self.get_participant_by_name(name)
        if participant and "is_sandbox" in participant:
            return participant["is_sandbox"]
        return False  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å—á–∏—Ç–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

    def list_participants(self) -> list:
        """
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∏–º—ë–Ω –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.
        –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ.
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ—Å—Ç–æ —Å–ø–∏—Å–æ–∫ –∏–º—ë–Ω: ['–ê–Ω–Ω–∞', '–ò–≤–∞–Ω', '–ú–∞—Ä–∏—è']
        """
        names = []
        if not os.path.exists(DATA_FILE):
            return names

        try:
            with open(DATA_FILE, "rb") as f:
                for line in f:
                    line = line.strip()
                    if not line:
                        continue
                    decrypted_data = self.cipher.decrypt(line).decode()
                    participant = json.loads(decrypted_data)
                    names.append(participant["name"])
        except Exception as e:
            print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞: {e}")
        return names

    def remove_participant(self, name: str) -> bool:
        """
        –£–¥–∞–ª—è–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–∞ –ø–æ –∏–º–µ–Ω–∏.
        –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:
        - –°—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç –∏—Ö
        - –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–∞–π–ª, –ø—Ä–æ–ø—É—Å–∫–∞—è –∑–∞–ø–∏—Å—å —Å –Ω—É–∂–Ω—ã–º –∏–º–µ–Ω–µ–º
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç True, –µ—Å–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫ –±—ã–ª –Ω–∞–π–¥–µ–Ω –∏ —É–¥–∞–ª—ë–Ω.
        """
        participants = self.list_all_decrypted()  # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        success = False  # –§–ª–∞–≥: —É–¥–∞–ª–∏–ª–∏ –ª–∏ –∫–æ–≥–æ-—Ç–æ

        # –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º —Ñ–∞–π–ª, –Ω–µ –≤–∫–ª—é—á–∞—è —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
        with open(DATA_FILE, "wb") as f:
            for p in participants:
                if p["name"] != name:
                    # –®–∏—Ñ—Ä—É–µ–º –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –≤—Å–µ—Ö, –∫—Ä–æ–º–µ —É–¥–∞–ª—è–µ–º–æ–≥–æ
                    encrypted = self.cipher.encrypt(json.dumps(p).encode())
                    f.write(encrypted + b"\n")
                else:
                    success = True  # –ù–∞—à–ª–∏ –∏ –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏ ‚Äî –∑–Ω–∞—á–∏—Ç, —É–¥–∞–ª–∏–ª–∏

        if success:
            print(f"üóëÔ∏è –£—á–∞—Å—Ç–Ω–∏–∫ '{name}' —É–¥–∞–ª—ë–Ω.")
        return success

    def list_all_decrypted(self) -> list:
        """
        –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥.
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ –≤–∏–¥–µ —Å–ª–æ–≤–∞—Ä–µ–π (—Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö).
        –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –¥—Ä—É–≥–∏—Ö –º–µ—Ç–æ–¥–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏.
        –ù–µ –¥–ª—è –ø—Ä—è–º–æ–≥–æ –≤—ã–∑–æ–≤–∞ –∏–∑–≤–Ω–µ ‚Äî –¥–∞–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞—é—Ç—Å—è, –ø–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–æ –±—ã—Ç—å –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã–º.
        """
        participants = []
        if not os.path.exists(DATA_FILE):
            return participants

        try:
            with open(DATA_FILE, "rb") as f:
                for line in f:
                    line = line.strip()
                    if not line:
                        continue
                    decrypted_data = self.cipher.decrypt(line).decode()
                    participant = json.loads(decrypted_data)
                    participants.append(participant)
        except Exception as e:
            print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–µ: {e}")
        return participants

